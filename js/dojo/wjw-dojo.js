/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.getObject("date.stamp",true,dojo);dojo.date.stamp.fromISOString=function(_1,_2){if(!dojo.date.stamp._isoRegExp){dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _3=dojo.date.stamp._isoRegExp.exec(_1),_4=null;if(_3){_3.shift();if(_3[1]){_3[1]--;}if(_3[6]){_3[6]*=1000;}if(_2){_2=new Date(_2);dojo.forEach(dojo.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(_5){return _2["get"+_5]();}),function(_6,_7){_3[_7]=_3[_7]||_6;});}_4=new Date(_3[0]||1970,_3[1]||0,_3[2]||1,_3[3]||0,_3[4]||0,_3[5]||0,_3[6]||0);if(_3[0]<100){_4.setFullYear(_3[0]||1970);}var _8=0,_9=_3[7]&&_3[7].charAt(0);if(_9!="Z"){_8=((_3[8]||0)*60)+(Number(_3[9])||0);if(_9!="-"){_8*=-1;}}if(_9){_8-=_4.getTimezoneOffset();}if(_8){_4.setTime(_4.getTime()+_8*60000);}}return _4;};dojo.date.stamp.toISOString=function(_a,_b){var _c=function(n){return (n<10)?"0"+n:n;};_b=_b||{};var _d=[],_e=_b.zulu?"getUTC":"get",_f="";if(_b.selector!="time"){var _10=_a[_e+"FullYear"]();_f=["0000".substr((_10+"").length)+_10,_c(_a[_e+"Month"]()+1),_c(_a[_e+"Date"]())].join("-");}_d.push(_f);if(_b.selector!="date"){var _11=[_c(_a[_e+"Hours"]()),_c(_a[_e+"Minutes"]()),_c(_a[_e+"Seconds"]())].join(":");var _12=_a[_e+"Milliseconds"]();if(_b.milliseconds){_11+="."+(_12<100?"0":"")+_c(_12);}if(_b.zulu){_11+="Z";}else{if(_b.selector!="time"){var _13=_a.getTimezoneOffset();var _14=Math.abs(_13);_11+=(_13>0?"-":"+")+_c(Math.floor(_14/60))+":"+_c(_14%60);}}_d.push(_11);}return _d.join("T");};}if(!dojo._hasResource["dojo.parser"]){dojo._hasResource["dojo.parser"]=true;dojo.provide("dojo.parser");new Date("X");dojo.parser=new function(){var d=dojo;function _15(_16){if(d.isString(_16)){return "string";}if(typeof _16=="number"){return "number";}if(typeof _16=="boolean"){return "boolean";}if(d.isFunction(_16)){return "function";}if(d.isArray(_16)){return "array";}if(_16 instanceof Date){return "date";}if(_16 instanceof d._Url){return "url";}return "object";};function _17(_18,_19){switch(_19){case "string":return _18;case "number":return _18.length?Number(_18):NaN;case "boolean":return typeof _18=="boolean"?_18:!(_18.toLowerCase()=="false");case "function":if(d.isFunction(_18)){_18=_18.toString();_18=d.trim(_18.substring(_18.indexOf("{")+1,_18.length-1));}try{if(_18===""||_18.search(/[^\w\.]+/i)!=-1){return new Function(_18);}else{return d.getObject(_18,false)||new Function(_18);}}catch(e){return new Function();}case "array":return _18?_18.split(/\s*,\s*/):[];case "date":switch(_18){case "":return new Date("");case "now":return new Date();default:return d.date.stamp.fromISOString(_18);}case "url":return d.baseUrl+_18;default:return d.fromJson(_18);}};var _1a={},_1b={};d.connect(d,"extend",function(){_1b={};});function _1c(cls,_1d){for(var _1e in cls){if(_1e.charAt(0)=="_"){continue;}if(_1e in _1a){continue;}_1d[_1e]=_15(cls[_1e]);}return _1d;};function _1f(_20,_21){var c=_1b[_20];if(!c){var cls=d.getObject(_20),_22=null;if(!cls){return null;}if(!_21){_22=_1c(cls.prototype,{});}c={cls:cls,params:_22};}else{if(!_21&&!c.params){c.params=_1c(c.cls.prototype,{});}}return c;};this._functionFromScript=function(_23,_24){var _25="";var _26="";var _27=(_23.getAttribute(_24+"args")||_23.getAttribute("args"));if(_27){d.forEach(_27.split(/\s*,\s*/),function(_28,idx){_25+="var "+_28+" = arguments["+idx+"]; ";});}var _29=_23.getAttribute("with");if(_29&&_29.length){d.forEach(_29.split(/\s*,\s*/),function(_2a){_25+="with("+_2a+"){";_26+="}";});}return new Function(_25+_23.innerHTML+_26);};this.instantiate=function(_2b,_2c,_2d){var _2e=[],_2c=_2c||{};_2d=_2d||{};var _2f=(_2d.scope||d._scopeName)+"Type",_30="data-"+(_2d.scope||d._scopeName)+"-";d.forEach(_2b,function(obj){if(!obj){return;}var _31,_32,_33,_34,_35,_36;if(obj.node){_31=obj.node;_32=obj.type;_36=obj.fastpath;_33=obj.clsInfo||(_32&&_1f(_32,_36));_34=_33&&_33.cls;_35=obj.scripts;}else{_31=obj;_32=_2f in _2c?_2c[_2f]:_31.getAttribute(_2f);_33=_32&&_1f(_32);_34=_33&&_33.cls;_35=(_34&&(_34._noScript||_34.prototype._noScript)?[]:d.query("> script[type^='dojo/']",_31));}if(!_33){throw new Error("Could not load class '"+_32);}var _37={};if(_2d.defaults){d._mixin(_37,_2d.defaults);}if(obj.inherited){d._mixin(_37,obj.inherited);}if(_36){var _38=_31.getAttribute(_30+"props");if(_38&&_38.length){try{_38=d.fromJson.call(_2d.propsThis,"{"+_38+"}");d._mixin(_37,_38);}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+_38+"'");}}var _39=_31.getAttribute(_30+"attach-point");if(_39){_37.dojoAttachPoint=_39;}var _3a=_31.getAttribute(_30+"attach-event");if(_3a){_37.dojoAttachEvent=_3a;}dojo.mixin(_37,_2c);}else{var _3b=_31.attributes;for(var _3c in _33.params){var _3d=_3c in _2c?{value:_2c[_3c],specified:true}:_3b.getNamedItem(_3c);if(!_3d||(!_3d.specified&&(!dojo.isIE||_3c.toLowerCase()!="value"))){continue;}var _3e=_3d.value;switch(_3c){case "class":_3e="className" in _2c?_2c.className:_31.className;break;case "style":_3e="style" in _2c?_2c.style:(_31.style&&_31.style.cssText);}var _3f=_33.params[_3c];if(typeof _3e=="string"){_37[_3c]=_17(_3e,_3f);}else{_37[_3c]=_3e;}}}var _40=[],_41=[];d.forEach(_35,function(_42){_31.removeChild(_42);var _43=(_42.getAttribute(_30+"event")||_42.getAttribute("event")),_32=_42.getAttribute("type"),nf=d.parser._functionFromScript(_42,_30);if(_43){if(_32=="dojo/connect"){_40.push({event:_43,func:nf});}else{_37[_43]=nf;}}else{_41.push(nf);}});var _44=_34.markupFactory||_34.prototype&&_34.prototype.markupFactory;var _45=_44?_44(_37,_31,_34):new _34(_37,_31);_2e.push(_45);var _46=(_31.getAttribute(_30+"id")||_31.getAttribute("jsId"));if(_46){d.setObject(_46,_45);}d.forEach(_40,function(_47){d.connect(_45,_47.event,null,_47.func);});d.forEach(_41,function(_48){_48.call(_45);});});if(!_2c._started){d.forEach(_2e,function(_49){if(!_2d.noStart&&_49&&dojo.isFunction(_49.startup)&&!_49._started&&(!_49.getParent||!_49.getParent())){_49.startup();}});}return _2e;};this.parse=function(_4a,_4b){var _4c;if(!_4b&&_4a&&_4a.rootNode){_4b=_4a;_4c=_4b.rootNode;}else{_4c=_4a;}_4b=_4b||{};var _4d=(_4b.scope||d._scopeName)+"Type",_4e="data-"+(_4b.scope||d._scopeName)+"-";function _4f(_50,_51){var _52=dojo.clone(_50.inherited);dojo.forEach(["dir","lang"],function(_53){var val=_50.node.getAttribute(_53);if(val){_52[_53]=val;}});var _54=_50.clsInfo&&!_50.clsInfo.cls.prototype._noScript?_50.scripts:null;var _55=(!_50.clsInfo||!_50.clsInfo.cls.prototype.stopParser)||(_4b&&_4b.template);for(var _56=_50.node.firstChild;_56;_56=_56.nextSibling){if(_56.nodeType==1){var _57,_58=_55&&_56.getAttribute(_4e+"type");if(_58){_57=_58;}else{_57=_55&&_56.getAttribute(_4d);}var _59=_58==_57;if(_57){var _5a={"type":_57,fastpath:_59,clsInfo:_1f(_57,_59),node:_56,scripts:[],inherited:_52};_51.push(_5a);_4f(_5a,_51);}else{if(_54&&_56.nodeName.toLowerCase()=="script"){_57=_56.getAttribute("type");if(_57&&/^dojo\/\w/i.test(_57)){_54.push(_56);}}else{if(_55){_4f({node:_56,inherited:_52},_51);}}}}}};var _5b=[];_4f({node:_4c?dojo.byId(_4c):dojo.body(),inherited:(_4b&&_4b.inherited)||{dir:dojo._isBodyLtr()?"ltr":"rtl"}},_5b);var _5c=_4b&&_4b.template?{template:true}:null;return this.instantiate(_5b,_5c,_4b);};}();(function(){var _5d=function(){if(dojo.config.parseOnLoad){dojo.parser.parse();}};if(dojo.getObject("dijit.wai.onload")===dojo._loaders[0]){dojo._loaders.splice(1,0,_5d);}else{dojo._loaders.unshift(_5d);}})();}if(!dojo._hasResource["dojo.data.util.filter"]){dojo._hasResource["dojo.data.util.filter"]=true;dojo.provide("dojo.data.util.filter");dojo.getObject("data.util.filter",true,dojo);dojo.data.util.filter.patternToRegExp=function(_5e,_5f){var rxp="^";var c=null;for(var i=0;i<_5e.length;i++){c=_5e.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_5e.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_5f){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};}if(!dojo._hasResource["dojo.data.util.sorter"]){dojo._hasResource["dojo.data.util.sorter"]=true;dojo.provide("dojo.data.util.sorter");dojo.getObject("data.util.sorter",true,dojo);dojo.data.util.sorter.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};dojo.data.util.sorter.createSortFunction=function(_60,_61){var _62=[];function _63(_64,dir,_65,s){return function(_66,_67){var a=s.getValue(_66,_64);var b=s.getValue(_67,_64);return dir*_65(a,b);};};var _68;var map=_61.comparatorMap;var bc=dojo.data.util.sorter.basicComparator;for(var i=0;i<_60.length;i++){_68=_60[i];var _69=_68.attribute;if(_69){var dir=(_68.descending)?-1:1;var _6a=bc;if(map){if(typeof _69!=="string"&&("toString" in _69)){_69=_69.toString();}_6a=map[_69]||bc;}_62.push(_63(_69,dir,_6a,_61));}}return function(_6b,_6c){var i=0;while(i<_62.length){var ret=_62[i++](_6b,_6c);if(ret!==0){return ret;}}return 0;};};}if(!dojo._hasResource["dojo.data.util.simpleFetch"]){dojo._hasResource["dojo.data.util.simpleFetch"]=true;dojo.provide("dojo.data.util.simpleFetch");dojo.getObject("data.util.simpleFetch",true,dojo);dojo.data.util.simpleFetch.fetch=function(_6d){_6d=_6d||{};if(!_6d.store){_6d.store=this;}var _6e=this;var _6f=function(_70,_71){if(_71.onError){var _72=_71.scope||dojo.global;_71.onError.call(_72,_70,_71);}};var _73=function(_74,_75){var _76=_75.abort||null;var _77=false;var _78=_75.start?_75.start:0;var _79=(_75.count&&(_75.count!==Infinity))?(_78+_75.count):_74.length;_75.abort=function(){_77=true;if(_76){_76.call(_75);}};var _7a=_75.scope||dojo.global;if(!_75.store){_75.store=_6e;}if(_75.onBegin){_75.onBegin.call(_7a,_74.length,_75);}if(_75.sort){_74.sort(dojo.data.util.sorter.createSortFunction(_75.sort,_6e));}if(_75.onItem){for(var i=_78;(i<_74.length)&&(i<_79);++i){var _7b=_74[i];if(!_77){_75.onItem.call(_7a,_7b,_75);}}}if(_75.onComplete&&!_77){var _7c=null;if(!_75.onItem){_7c=_74.slice(_78,_79);}_75.onComplete.call(_7a,_7c,_75);}};this._fetchItems(_6d,_73,_6f);return _6d;};}if(!dojo._hasResource["dojo.data.ItemFileReadStore"]){dojo._hasResource["dojo.data.ItemFileReadStore"]=true;dojo.provide("dojo.data.ItemFileReadStore");dojo.declare("dojo.data.ItemFileReadStore",null,{constructor:function(_7d){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._jsonFileUrl=_7d.url;this._ccUrl=_7d.url;this.url=_7d.url;this._jsonData=_7d.data;this.data=null;this._datatypeMap=_7d.typeMap||{};if(!this._datatypeMap["Date"]){this._datatypeMap["Date"]={type:Date,deserialize:function(_7e){return dojo.date.stamp.fromISOString(_7e);}};}this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=false;this._queuedFetches=[];if(_7d.urlPreventCache!==undefined){this.urlPreventCache=_7d.urlPreventCache?true:false;}if(_7d.hierarchical!==undefined){this.hierarchical=_7d.hierarchical?true:false;}if(_7d.clearOnClose){this.clearOnClose=true;}if("failOk" in _7d){this.failOk=_7d.failOk?true:false;}},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:false,urlPreventCache:false,failOk:false,hierarchical:true,_assertIsItem:function(_7f){if(!this.isItem(_7f)){throw new Error("dojo.data.ItemFileReadStore: Invalid item argument.");}},_assertIsAttribute:function(_80){if(typeof _80!=="string"){throw new Error("dojo.data.ItemFileReadStore: Invalid attribute argument.");}},getValue:function(_81,_82,_83){var _84=this.getValues(_81,_82);return (_84.length>0)?_84[0]:_83;},getValues:function(_85,_86){this._assertIsItem(_85);this._assertIsAttribute(_86);return (_85[_86]||[]).slice(0);},getAttributes:function(_87){this._assertIsItem(_87);var _88=[];for(var key in _87){if((key!==this._storeRefPropName)&&(key!==this._itemNumPropName)&&(key!==this._rootItemPropName)&&(key!==this._reverseRefMap)){_88.push(key);}}return _88;},hasAttribute:function(_89,_8a){this._assertIsItem(_89);this._assertIsAttribute(_8a);return (_8a in _89);},containsValue:function(_8b,_8c,_8d){var _8e=undefined;if(typeof _8d==="string"){_8e=dojo.data.util.filter.patternToRegExp(_8d,false);}return this._containsValue(_8b,_8c,_8d,_8e);},_containsValue:function(_8f,_90,_91,_92){return dojo.some(this.getValues(_8f,_90),function(_93){if(_93!==null&&!dojo.isObject(_93)&&_92){if(_93.toString().match(_92)){return true;}}else{if(_91===_93){return true;}}});},isItem:function(_94){if(_94&&_94[this._storeRefPropName]===this){if(this._arrayOfAllItems[_94[this._itemNumPropName]]===_94){return true;}}return false;},isItemLoaded:function(_95){return this.isItem(_95);},loadItem:function(_96){this._assertIsItem(_96.item);},getFeatures:function(){return this._features;},getLabel:function(_97){if(this._labelAttr&&this.isItem(_97)){return this.getValue(_97,this._labelAttr);}return undefined;},getLabelAttributes:function(_98){if(this._labelAttr){return [this._labelAttr];}return null;},_fetchItems:function(_99,_9a,_9b){var _9c=this,_9d=function(_9e,_9f){var _a0=[],i,key;if(_9e.query){var _a1,_a2=_9e.queryOptions?_9e.queryOptions.ignoreCase:false;var _a3={};for(key in _9e.query){_a1=_9e.query[key];if(typeof _a1==="string"){_a3[key]=dojo.data.util.filter.patternToRegExp(_a1,_a2);}else{if(_a1 instanceof RegExp){_a3[key]=_a1;}}}for(i=0;i<_9f.length;++i){var _a4=true;var _a5=_9f[i];if(_a5===null){_a4=false;}else{for(key in _9e.query){_a1=_9e.query[key];if(!_9c._containsValue(_a5,key,_a1,_a3[key])){_a4=false;}}}if(_a4){_a0.push(_a5);}}_9a(_a0,_9e);}else{for(i=0;i<_9f.length;++i){var _a6=_9f[i];if(_a6!==null){_a0.push(_a6);}}_9a(_a0,_9e);}};if(this._loadFinished){_9d(_99,this._getItemsArray(_99.queryOptions));}else{if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_99,filter:_9d});}else{this._loadInProgress=true;var _a7={url:_9c._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _a8=dojo.xhrGet(_a7);_a8.addCallback(function(_a9){try{_9c._getItemsFromLoadedData(_a9);_9c._loadFinished=true;_9c._loadInProgress=false;_9d(_99,_9c._getItemsArray(_99.queryOptions));_9c._handleQueuedFetches();}catch(e){_9c._loadFinished=true;_9c._loadInProgress=false;_9b(e,_99);}});_a8.addErrback(function(_aa){_9c._loadInProgress=false;_9b(_aa,_99);});var _ab=null;if(_99.abort){_ab=_99.abort;}_99.abort=function(){var df=_a8;if(df&&df.fired===-1){df.cancel();df=null;}if(_ab){_ab.call(_99);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;_9d(_99,this._getItemsArray(_99.queryOptions));}catch(e){_9b(e,_99);}}else{_9b(new Error("dojo.data.ItemFileReadStore: No JSON source data was provided as either URL or a nested Javascript object."),_99);}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _ac=this._queuedFetches[i],_ad=_ac.args,_ae=_ac.filter;if(_ae){_ae(_ad,this._getItemsArray(_ad.queryOptions));}else{this.fetchItemByIdentity(_ad);}}this._queuedFetches=[];}},_getItemsArray:function(_af){if(_af&&_af.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},close:function(_b0){if(this.clearOnClose&&this._loadFinished&&!this._loadInProgress){if(((this._jsonFileUrl==""||this._jsonFileUrl==null)&&(this.url==""||this.url==null))&&this.data==null){console.debug("dojo.data.ItemFileReadStore: WARNING!  Data reload "+" information has not been provided."+"  Please set 'url' or 'data' to the appropriate value before"+" the next fetch");}this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._itemsByIdentity=null;this._loadInProgress=false;this._queuedFetches=[];}},_getItemsFromLoadedData:function(_b1){var _b2=false,_b3=this;function _b4(_b5){var _b6=((_b5!==null)&&(typeof _b5==="object")&&(!dojo.isArray(_b5)||_b2)&&(!dojo.isFunction(_b5))&&(_b5.constructor==Object||dojo.isArray(_b5))&&(typeof _b5._reference==="undefined")&&(typeof _b5._type==="undefined")&&(typeof _b5._value==="undefined")&&_b3.hierarchical);return _b6;};function _b7(_b8){_b3._arrayOfAllItems.push(_b8);for(var _b9 in _b8){var _ba=_b8[_b9];if(_ba){if(dojo.isArray(_ba)){var _bb=_ba;for(var k=0;k<_bb.length;++k){var _bc=_bb[k];if(_b4(_bc)){_b7(_bc);}}}else{if(_b4(_ba)){_b7(_ba);}}}}};this._labelAttr=_b1.label;var i,_bd;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=_b1.items;for(i=0;i<this._arrayOfTopLevelItems.length;++i){_bd=this._arrayOfTopLevelItems[i];if(dojo.isArray(_bd)){_b2=true;}_b7(_bd);_bd[this._rootItemPropName]=true;}var _be={},key;for(i=0;i<this._arrayOfAllItems.length;++i){_bd=this._arrayOfAllItems[i];for(key in _bd){if(key!==this._rootItemPropName){var _bf=_bd[key];if(_bf!==null){if(!dojo.isArray(_bf)){_bd[key]=[_bf];}}else{_bd[key]=[null];}}_be[key]=key;}}while(_be[this._storeRefPropName]){this._storeRefPropName+="_";}while(_be[this._itemNumPropName]){this._itemNumPropName+="_";}while(_be[this._reverseRefMap]){this._reverseRefMap+="_";}var _c0;var _c1=_b1.identifier;if(_c1){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=_c1;for(i=0;i<this._arrayOfAllItems.length;++i){_bd=this._arrayOfAllItems[i];_c0=_bd[_c1];var _c2=_c0[0];if(!Object.hasOwnProperty.call(this._itemsByIdentity,_c2)){this._itemsByIdentity[_c2]=_bd;}else{if(this._jsonFileUrl){throw new Error("dojo.data.ItemFileReadStore:  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+_c1+"].  Value collided: ["+_c2+"]");}else{if(this._jsonData){throw new Error("dojo.data.ItemFileReadStore:  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+_c1+"].  Value collided: ["+_c2+"]");}}}}}else{this._features["dojo.data.api.Identity"]=Number;}for(i=0;i<this._arrayOfAllItems.length;++i){_bd=this._arrayOfAllItems[i];_bd[this._storeRefPropName]=this;_bd[this._itemNumPropName]=i;}for(i=0;i<this._arrayOfAllItems.length;++i){_bd=this._arrayOfAllItems[i];for(key in _bd){_c0=_bd[key];for(var j=0;j<_c0.length;++j){_bf=_c0[j];if(_bf!==null&&typeof _bf=="object"){if(("_type" in _bf)&&("_value" in _bf)){var _c3=_bf._type;var _c4=this._datatypeMap[_c3];if(!_c4){throw new Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+_c3+"'");}else{if(dojo.isFunction(_c4)){_c0[j]=new _c4(_bf._value);}else{if(dojo.isFunction(_c4.deserialize)){_c0[j]=_c4.deserialize(_bf._value);}else{throw new Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");}}}}if(_bf._reference){var _c5=_bf._reference;if(!dojo.isObject(_c5)){_c0[j]=this._getItemByIdentity(_c5);}else{for(var k=0;k<this._arrayOfAllItems.length;++k){var _c6=this._arrayOfAllItems[k],_c7=true;for(var _c8 in _c5){if(_c6[_c8]!=_c5[_c8]){_c7=false;}}if(_c7){_c0[j]=_c6;}}}if(this.referenceIntegrity){var _c9=_c0[j];if(this.isItem(_c9)){this._addReferenceToMap(_c9,_bd,key);}}}else{if(this.isItem(_bf)){if(this.referenceIntegrity){this._addReferenceToMap(_bf,_bd,key);}}}}}}}},_addReferenceToMap:function(_ca,_cb,_cc){},getIdentity:function(_cd){var _ce=this._features["dojo.data.api.Identity"];if(_ce===Number){return _cd[this._itemNumPropName];}else{var _cf=_cd[_ce];if(_cf){return _cf[0];}}return null;},fetchItemByIdentity:function(_d0){var _d1,_d2;if(!this._loadFinished){var _d3=this;if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_d0});}else{this._loadInProgress=true;var _d4={url:_d3._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _d5=dojo.xhrGet(_d4);_d5.addCallback(function(_d6){var _d7=_d0.scope?_d0.scope:dojo.global;try{_d3._getItemsFromLoadedData(_d6);_d3._loadFinished=true;_d3._loadInProgress=false;_d1=_d3._getItemByIdentity(_d0.identity);if(_d0.onItem){_d0.onItem.call(_d7,_d1);}_d3._handleQueuedFetches();}catch(error){_d3._loadInProgress=false;if(_d0.onError){_d0.onError.call(_d7,error);}}});_d5.addErrback(function(_d8){_d3._loadInProgress=false;if(_d0.onError){var _d9=_d0.scope?_d0.scope:dojo.global;_d0.onError.call(_d9,_d8);}});}}else{if(this._jsonData){_d3._getItemsFromLoadedData(_d3._jsonData);_d3._jsonData=null;_d3._loadFinished=true;_d1=_d3._getItemByIdentity(_d0.identity);if(_d0.onItem){_d2=_d0.scope?_d0.scope:dojo.global;_d0.onItem.call(_d2,_d1);}}}}else{_d1=this._getItemByIdentity(_d0.identity);if(_d0.onItem){_d2=_d0.scope?_d0.scope:dojo.global;_d0.onItem.call(_d2,_d1);}}},_getItemByIdentity:function(_da){var _db=null;if(this._itemsByIdentity&&Object.hasOwnProperty.call(this._itemsByIdentity,_da)){_db=this._itemsByIdentity[_da];}else{if(Object.hasOwnProperty.call(this._arrayOfAllItems,_da)){_db=this._arrayOfAllItems[_da];}}if(_db===undefined){_db=null;}return _db;},getIdentityAttributes:function(_dc){var _dd=this._features["dojo.data.api.Identity"];if(_dd===Number){return null;}else{return [_dd];}},_forceLoad:function(){var _de=this;if(this._jsonFileUrl!==this._ccUrl){dojo.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){var _df={url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:true};var _e0=dojo.xhrGet(_df);_e0.addCallback(function(_e1){try{if(_de._loadInProgress!==true&&!_de._loadFinished){_de._getItemsFromLoadedData(_e1);_de._loadFinished=true;}else{if(_de._loadInProgress){throw new Error("dojo.data.ItemFileReadStore:  Unable to perform a synchronous load, an async load is in progress.");}}}catch(e){console.log(e);throw e;}});_e0.addErrback(function(_e2){throw _e2;});}else{if(this._jsonData){_de._getItemsFromLoadedData(_de._jsonData);_de._jsonData=null;_de._loadFinished=true;}}}});dojo.extend(dojo.data.ItemFileReadStore,dojo.data.util.simpleFetch);}if(!dojo._hasResource["dojo.data.ItemFileWriteStore"]){dojo._hasResource["dojo.data.ItemFileWriteStore"]=true;dojo.provide("dojo.data.ItemFileWriteStore");dojo.declare("dojo.data.ItemFileWriteStore",dojo.data.ItemFileReadStore,{constructor:function(_e3){this._features["dojo.data.api.Write"]=true;this._features["dojo.data.api.Notification"]=true;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};if(!this._datatypeMap["Date"].serialize){this._datatypeMap["Date"].serialize=function(obj){return dojo.date.stamp.toISOString(obj,{zulu:true});};}if(_e3&&(_e3.referenceIntegrity===false)){this.referenceIntegrity=false;}this._saveInProgress=false;},referenceIntegrity:true,_assert:function(_e4){if(!_e4){throw new Error("assertion failed in ItemFileWriteStore");}},_getIdentifierAttribute:function(){var _e5=this.getFeatures()["dojo.data.api.Identity"];return _e5;},newItem:function(_e6,_e7){this._assert(!this._saveInProgress);if(!this._loadFinished){this._forceLoad();}if(typeof _e6!="object"&&typeof _e6!="undefined"){throw new Error("newItem() was passed something other than an object");}var _e8=null;var _e9=this._getIdentifierAttribute();if(_e9===Number){_e8=this._arrayOfAllItems.length;}else{_e8=_e6[_e9];if(typeof _e8==="undefined"){throw new Error("newItem() was not passed an identity for the new item");}if(dojo.isArray(_e8)){throw new Error("newItem() was not passed an single-valued identity");}}if(this._itemsByIdentity){this._assert(typeof this._itemsByIdentity[_e8]==="undefined");}this._assert(typeof this._pending._newItems[_e8]==="undefined");this._assert(typeof this._pending._deletedItems[_e8]==="undefined");var _ea={};_ea[this._storeRefPropName]=this;_ea[this._itemNumPropName]=this._arrayOfAllItems.length;if(this._itemsByIdentity){this._itemsByIdentity[_e8]=_ea;_ea[_e9]=[_e8];}this._arrayOfAllItems.push(_ea);var _eb=null;if(_e7&&_e7.parent&&_e7.attribute){_eb={item:_e7.parent,attribute:_e7.attribute,oldValue:undefined};var _ec=this.getValues(_e7.parent,_e7.attribute);if(_ec&&_ec.length>0){var _ed=_ec.slice(0,_ec.length);if(_ec.length===1){_eb.oldValue=_ec[0];}else{_eb.oldValue=_ec.slice(0,_ec.length);}_ed.push(_ea);this._setValueOrValues(_e7.parent,_e7.attribute,_ed,false);_eb.newValue=this.getValues(_e7.parent,_e7.attribute);}else{this._setValueOrValues(_e7.parent,_e7.attribute,_ea,false);_eb.newValue=_ea;}}else{_ea[this._rootItemPropName]=true;this._arrayOfTopLevelItems.push(_ea);}this._pending._newItems[_e8]=_ea;for(var key in _e6){if(key===this._storeRefPropName||key===this._itemNumPropName){throw new Error("encountered bug in ItemFileWriteStore.newItem");}var _ee=_e6[key];if(!dojo.isArray(_ee)){_ee=[_ee];}_ea[key]=_ee;if(this.referenceIntegrity){for(var i=0;i<_ee.length;i++){var val=_ee[i];if(this.isItem(val)){this._addReferenceToMap(val,_ea,key);}}}}this.onNew(_ea,_eb);return _ea;},_removeArrayElement:function(_ef,_f0){var _f1=dojo.indexOf(_ef,_f0);if(_f1!=-1){_ef.splice(_f1,1);return true;}return false;},deleteItem:function(_f2){this._assert(!this._saveInProgress);this._assertIsItem(_f2);var _f3=_f2[this._itemNumPropName];var _f4=this.getIdentity(_f2);if(this.referenceIntegrity){var _f5=this.getAttributes(_f2);if(_f2[this._reverseRefMap]){_f2["backup_"+this._reverseRefMap]=dojo.clone(_f2[this._reverseRefMap]);}dojo.forEach(_f5,function(_f6){dojo.forEach(this.getValues(_f2,_f6),function(_f7){if(this.isItem(_f7)){if(!_f2["backupRefs_"+this._reverseRefMap]){_f2["backupRefs_"+this._reverseRefMap]=[];}_f2["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(_f7),attr:_f6});this._removeReferenceFromMap(_f7,_f2,_f6);}},this);},this);var _f8=_f2[this._reverseRefMap];if(_f8){for(var _f9 in _f8){var _fa=null;if(this._itemsByIdentity){_fa=this._itemsByIdentity[_f9];}else{_fa=this._arrayOfAllItems[_f9];}if(_fa){for(var _fb in _f8[_f9]){var _fc=this.getValues(_fa,_fb)||[];var _fd=dojo.filter(_fc,function(_fe){return !(this.isItem(_fe)&&this.getIdentity(_fe)==_f4);},this);this._removeReferenceFromMap(_f2,_fa,_fb);if(_fd.length<_fc.length){this._setValueOrValues(_fa,_fb,_fd,true);}}}}}}this._arrayOfAllItems[_f3]=null;_f2[this._storeRefPropName]=null;if(this._itemsByIdentity){delete this._itemsByIdentity[_f4];}this._pending._deletedItems[_f4]=_f2;if(_f2[this._rootItemPropName]){this._removeArrayElement(this._arrayOfTopLevelItems,_f2);}this.onDelete(_f2);return true;},setValue:function(_ff,_100,_101){return this._setValueOrValues(_ff,_100,_101,true);},setValues:function(item,_102,_103){return this._setValueOrValues(item,_102,_103,true);},unsetAttribute:function(item,_104){return this._setValueOrValues(item,_104,[],true);},_setValueOrValues:function(item,_105,_106,_107){this._assert(!this._saveInProgress);this._assertIsItem(item);this._assert(dojo.isString(_105));this._assert(typeof _106!=="undefined");var _108=this._getIdentifierAttribute();if(_105==_108){throw new Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");}var _109=this._getValueOrValues(item,_105);var _10a=this.getIdentity(item);if(!this._pending._modifiedItems[_10a]){var _10b={};for(var key in item){if((key===this._storeRefPropName)||(key===this._itemNumPropName)||(key===this._rootItemPropName)){_10b[key]=item[key];}else{if(key===this._reverseRefMap){_10b[key]=dojo.clone(item[key]);}else{_10b[key]=item[key].slice(0,item[key].length);}}}this._pending._modifiedItems[_10a]=_10b;}var _10c=false;if(dojo.isArray(_106)&&_106.length===0){_10c=delete item[_105];_106=undefined;if(this.referenceIntegrity&&_109){var _10d=_109;if(!dojo.isArray(_10d)){_10d=[_10d];}for(var i=0;i<_10d.length;i++){var _10e=_10d[i];if(this.isItem(_10e)){this._removeReferenceFromMap(_10e,item,_105);}}}}else{var _10f;if(dojo.isArray(_106)){var _110=_106;_10f=_106.slice(0,_106.length);}else{_10f=[_106];}if(this.referenceIntegrity){if(_109){var _10d=_109;if(!dojo.isArray(_10d)){_10d=[_10d];}var map={};dojo.forEach(_10d,function(_111){if(this.isItem(_111)){var id=this.getIdentity(_111);map[id.toString()]=true;}},this);dojo.forEach(_10f,function(_112){if(this.isItem(_112)){var id=this.getIdentity(_112);if(map[id.toString()]){delete map[id.toString()];}else{this._addReferenceToMap(_112,item,_105);}}},this);for(var rId in map){var _113;if(this._itemsByIdentity){_113=this._itemsByIdentity[rId];}else{_113=this._arrayOfAllItems[rId];}this._removeReferenceFromMap(_113,item,_105);}}else{for(var i=0;i<_10f.length;i++){var _10e=_10f[i];if(this.isItem(_10e)){this._addReferenceToMap(_10e,item,_105);}}}}item[_105]=_10f;_10c=true;}if(_107){this.onSet(item,_105,_109,_106);}return _10c;},_addReferenceToMap:function(_114,_115,_116){var _117=this.getIdentity(_115);var _118=_114[this._reverseRefMap];if(!_118){_118=_114[this._reverseRefMap]={};}var _119=_118[_117];if(!_119){_119=_118[_117]={};}_119[_116]=true;},_removeReferenceFromMap:function(_11a,_11b,_11c){var _11d=this.getIdentity(_11b);var _11e=_11a[this._reverseRefMap];var _11f;if(_11e){for(_11f in _11e){if(_11f==_11d){delete _11e[_11f][_11c];if(this._isEmpty(_11e[_11f])){delete _11e[_11f];}}}if(this._isEmpty(_11e)){delete _11a[this._reverseRefMap];}}},_dumpReferenceMap:function(){var i;for(i=0;i<this._arrayOfAllItems.length;i++){var item=this._arrayOfAllItems[i];if(item&&item[this._reverseRefMap]){console.log("Item: ["+this.getIdentity(item)+"] is referenced by: "+dojo.toJson(item[this._reverseRefMap]));}}},_getValueOrValues:function(item,_120){var _121=undefined;if(this.hasAttribute(item,_120)){var _122=this.getValues(item,_120);if(_122.length==1){_121=_122[0];}else{_121=_122;}}return _121;},_flatten:function(_123){if(this.isItem(_123)){var item=_123;var _124=this.getIdentity(item);var _125={_reference:_124};return _125;}else{if(typeof _123==="object"){for(var type in this._datatypeMap){var _126=this._datatypeMap[type];if(dojo.isObject(_126)&&!dojo.isFunction(_126)){if(_123 instanceof _126.type){if(!_126.serialize){throw new Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+type+"]");}return {_type:type,_value:_126.serialize(_123)};}}else{if(_123 instanceof _126){return {_type:type,_value:_123.toString()};}}}}return _123;}},_getNewFileContentString:function(){var _127={};var _128=this._getIdentifierAttribute();if(_128!==Number){_127.identifier=_128;}if(this._labelAttr){_127.label=this._labelAttr;}_127.items=[];for(var i=0;i<this._arrayOfAllItems.length;++i){var item=this._arrayOfAllItems[i];if(item!==null){var _129={};for(var key in item){if(key!==this._storeRefPropName&&key!==this._itemNumPropName&&key!==this._reverseRefMap&&key!==this._rootItemPropName){var _12a=key;var _12b=this.getValues(item,_12a);if(_12b.length==1){_129[_12a]=this._flatten(_12b[0]);}else{var _12c=[];for(var j=0;j<_12b.length;++j){_12c.push(this._flatten(_12b[j]));_129[_12a]=_12c;}}}}_127.items.push(_129);}}var _12d=true;return dojo.toJson(_127,_12d);},_isEmpty:function(_12e){var _12f=true;if(dojo.isObject(_12e)){var i;for(i in _12e){_12f=false;break;}}else{if(dojo.isArray(_12e)){if(_12e.length>0){_12f=false;}}}return _12f;},save:function(_130){this._assert(!this._saveInProgress);this._saveInProgress=true;var self=this;var _131=function(){self._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};self._saveInProgress=false;if(_130&&_130.onComplete){var _132=_130.scope||dojo.global;_130.onComplete.call(_132);}};var _133=function(err){self._saveInProgress=false;if(_130&&_130.onError){var _134=_130.scope||dojo.global;_130.onError.call(_134,err);}};if(this._saveEverything){var _135=this._getNewFileContentString();this._saveEverything(_131,_133,_135);}if(this._saveCustom){this._saveCustom(_131,_133);}if(!this._saveEverything&&!this._saveCustom){_131();}},revert:function(){this._assert(!this._saveInProgress);var _136;for(_136 in this._pending._modifiedItems){var _137=this._pending._modifiedItems[_136];var _138=null;if(this._itemsByIdentity){_138=this._itemsByIdentity[_136];}else{_138=this._arrayOfAllItems[_136];}_137[this._storeRefPropName]=this;for(key in _138){delete _138[key];}dojo.mixin(_138,_137);}var _139;for(_136 in this._pending._deletedItems){_139=this._pending._deletedItems[_136];_139[this._storeRefPropName]=this;var _13a=_139[this._itemNumPropName];if(_139["backup_"+this._reverseRefMap]){_139[this._reverseRefMap]=_139["backup_"+this._reverseRefMap];delete _139["backup_"+this._reverseRefMap];}this._arrayOfAllItems[_13a]=_139;if(this._itemsByIdentity){this._itemsByIdentity[_136]=_139;}if(_139[this._rootItemPropName]){this._arrayOfTopLevelItems.push(_139);}}for(_136 in this._pending._deletedItems){_139=this._pending._deletedItems[_136];if(_139["backupRefs_"+this._reverseRefMap]){dojo.forEach(_139["backupRefs_"+this._reverseRefMap],function(_13b){var _13c;if(this._itemsByIdentity){_13c=this._itemsByIdentity[_13b.id];}else{_13c=this._arrayOfAllItems[_13b.id];}this._addReferenceToMap(_13c,_139,_13b.attr);},this);delete _139["backupRefs_"+this._reverseRefMap];}}for(_136 in this._pending._newItems){var _13d=this._pending._newItems[_136];_13d[this._storeRefPropName]=null;this._arrayOfAllItems[_13d[this._itemNumPropName]]=null;if(_13d[this._rootItemPropName]){this._removeArrayElement(this._arrayOfTopLevelItems,_13d);}if(this._itemsByIdentity){delete this._itemsByIdentity[_136];}}this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return true;},isDirty:function(item){if(item){var _13e=this.getIdentity(item);return new Boolean(this._pending._newItems[_13e]||this._pending._modifiedItems[_13e]||this._pending._deletedItems[_13e]).valueOf();}else{if(!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)){return true;}return false;}},onSet:function(item,_13f,_140,_141){},onNew:function(_142,_143){},onDelete:function(_144){},close:function(_145){if(this.clearOnClose){if(!this.isDirty()){this.inherited(arguments);}else{throw new Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");}}}});}
